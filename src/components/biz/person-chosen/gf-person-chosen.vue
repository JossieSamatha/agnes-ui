<template>
    <div class="person-chosen">
        <el-button type="text" @click="chooseUser">选择人员</el-button>
        <chosen-list-view v-if="memberList.length>0"
                          :personList="personList"
                          :groupList="groupList"
                          :rosterList="rosterList"
        ></chosen-list-view>
    </div>
</template>

<script>
    import chosenListView from './chosen-list-view'
    export default {
        name: 'gf-person-chosen-input',
        props: {
            memberRefList: {
                type: Array,
                required: true
            },
            chosenType: {
                type: String,
                default: 'user, group, roster'
            },
            rosterDate: {
                type: String
            }
        },
        data() {
            return {
                personList: [],
                groupList: [],
                rosterList: []
            }
        },
        beforeMount(){
            this.initPerson();
        },
        components: {
            'chosen-list-view': chosenListView
        },
        watch: {
            memberRefList(val){
                this.memberRefList = val;
                this.initPerson();
            }
        },
        computed: {
            memberList(){
                const memberList =  this.personList.concat(this.groupList).concat(this.rosterList);
                return memberList;
            }
        },
        methods: {
            initPerson(){
                const typeArr = ['', 'personList', 'groupList', 'rosterList'];
                this.personList = [];
                this.groupList = [];
                this.rosterList = [];
                this.memberRefList.forEach((memberItem)=>{
                    if(this[typeArr[memberItem.refType]]){
                        this[typeArr[memberItem.refType]].push(memberItem);
                    }
                });
            },
            // 打开人员选择弹窗
            chooseUser(){
                this.$nav.showDialog(
                    'person-chosen-dialog',
                    {
                        width: '850px',
                        args: {
                            personList: JSON.parse(JSON.stringify(this.personList)),
                            groupList: JSON.parse(JSON.stringify(this.groupList)),
                            rosterList: JSON.parse(JSON.stringify(this.rosterList)),
                            chosenType: this.chosenType,
                            rosterDate: this.rosterDate,
                            actionOk: this.getChosenList.bind(this)
                        },
                        title: this.$dialog.formatTitle('选择用户','edit'),
                    }
                );
            },

            getChosenList(personList, groupList, rosterList){
                this.personList = personList;
                this.groupList = groupList;
                this.rosterList = rosterList;
            }
        }
    }
</script>